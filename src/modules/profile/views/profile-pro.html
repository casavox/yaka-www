<style type="text/css">
    #map_canvas {
        height: 327px;
        width: calc(100% + 30px);
        margin-left: -15px;
        margin-right: -15px;
    }

    #map_canvas {
        position: relative;
    }

    .angular-google-map-container {
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
    }
</style>
<section class="view">
    <div class="header-menu">
        <ng-include src="'/modules/core/modules/menu/views/menuHamburger.html'"></ng-include>
        <div class="title">
            PROFILE
        </div>

        <a ng-click="app.logout()">
            <div class="logout">
                Log Out
            </div>
        </a>
    </div>
    <div class="page-content">
        <div class="content-slide p-20">
            <div class="row">
                <div class="col-md-12" ng-show="vm.profile.status != 'COMPLETED'">
                    <div class="profile-info-warning">
                        <p>
                            <span ng-if="vm.profile.status == 'REGISTERED'">
                                Votre profil est incomplet, vous devez compléter toutes les informations soulignées en
                                rouge pour pouvoir répondre à une offre
                            </span>
                            <span ng-if="vm.profile.status == 'WAITING'">
                                Votre profil est en cours de validation, vous recevrez un mail dès qu'il aura été
                                vérifié
                            </span>
                            <span ng-if="vm.profile.status == 'REFUSED'">
                                Nous n'avons pas pu vérifier votre profil
                            </span>
                            <span ng-if="vm.profile.status == 'VALIDATED'">
                                Compléter votre profil augmente votre visibilité et vos chances d'être sélectionné
                            </span>
                        </p>

                        <p>
                            <span ng-if="vm.profile.status == 'REFUSED' && vm.profile.refusedReason != ''">
                                Raison : {{vm.profile.refusedReason}}
                            </span>
                        </p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="menu-category profile-info">
                        <div class="profile-box">
                            <p>
                                Informations générales
                            </p>

                            <div class="row">
                                <div class="col-md-3">
                                    <div class="img-profile">
                                        <cl-image public-id="{{vm.profileInfo.avatar.cloudinaryPublicId}}"
                                                  secure="true" format="png"
                                                  class="img-circle center-middle pro-icon"
                                                  ng-show="vm.profileInfo.avatar.cloudinaryPublicId">
                                            <cl-transformation height="92" width="92" crop="fill"/>
                                        </cl-image>
                                        <div class="img-default center"
                                             ng-show="!vm.profileInfo.avatar.cloudinaryPublicId">
                                            {{vm.profileInfo.user.firstName[0] | uppercase}}
                                            {{vm.profileInfo.user.lastName[0] |
                                            uppercase}}
                                        </div>
                                        <div class="icon-edit cursor-pointer"
                                             ngf-select="vm.uploadProfile($files, $invalidFiles, 0)"
                                             ngf-accept="'image/*'" ngf-max-size="5MB">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-9">

                                    <div class="form-group fg-float m-b-30"
                                         ng-class="{'has-error': !vm.profileInfo.user.firstName}">
                                        <div class="fg-line">
                                            <input type="text" class="form-control fg-input"
                                                   ng-model="vm.profileInfo.user.firstName">
                                            <label class="fg-label">Prénom</label>
                                        </div>
                                    </div>
                                    <div class="form-group fg-float m-b-30"
                                         ng-class="{'has-error': !vm.profileInfo.user.lastName}">
                                        <div class="fg-line">
                                            <input type="text" class="form-control fg-input"
                                                   ng-model="vm.profileInfo.user.lastName">
                                            <label class="fg-label">Nom</label>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="form-group fg-float m-b-30"
                                 ng-class="{'has-error': !vm.profileInfo.phoneNumber}">
                                <div class="fg-line">
                                    <input international-phone-number default-country="fr"
                                           preferred-countries="fr" type="text" class="form-control fg-input"
                                           ng-model="vm.profileInfo.phoneNumber">
                                    <label class="fg-label">Téléphone</label>
                                </div>
                            </div>

                            <div class="form-group fg-float"
                                 ng-class="{'has-error': !vm.profileInfo.user.email}">
                                <div class="fg-line">
                                    <input type="text" class="form-control fg-input"
                                           ng-model="vm.profileInfo.user.email">
                                    <label class="fg-label">Email</label>
                                </div>
                            </div>

                            <div class="form-group m-b-30"
                                 ng-class="{'has-error': !vm.profileInfo.activityStartedYear}">
                                <div class="fg-line">
                                    <div class="select">
                                        <select ng-model="vm.profileInfo.activityStartedYear"
                                                class="form-control">
                                            <option value="" disabled selected>Première année d'expérience</option>
                                            <option ng-repeat="year in vm.years | orderBy:'-toString()'"
                                                    value="{{year}}">
                                                {{year}}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group fg-float m-b-30"
                                 ng-class="{'has-error': !vm.profileInfo.company.name}">
                                <div class="fg-line">
                                    <input type="text" class="form-control fg-input"
                                           ng-model="vm.profileInfo.company.name">
                                    <label class="fg-label">Nom de l'entreprise</label>
                                </div>
                            </div>

                            <div class="form-group fg-float m-b-30"
                                 ng-class="{'has-error': !vm.profileInfo.company.siret}">
                                <div class="fg-line">
                                    <input siret-validate type="text" class="form-control fg-input"
                                           ng-model="vm.profileInfo.company.siret">
                                    <label class="fg-label">SIRET</label>
                                </div>
                            </div>

                            <div class="form-group fg-float m-b-30"
                                 ng-class="{'has-error': !vm.profileInfo.company.address.address}">
                                <div class="fg-line">
                                    <input type="text" class="form-control fg-input"
                                           vs-google-autocomplete="options"
                                           ng-model="vm.profileInfo.company.address.address"
                                           type="text"
                                           name="address"
                                           placeholder=""
                                           id="address">
                                    <label class="fg-label">Addresse de l'entreprise</label>
                                </div>
                            </div>

                            <div class="form-group fg-float m-b-30"
                                 ng-class="{'has-error': !vm.profileInfo.company.phone}">
                                <div class="fg-line">
                                    <input international-phone-number default-country="fr"
                                           preferred-countries="fr" type="text" class="form-control fg-input"
                                           ng-model="vm.profileInfo.company.phone">
                                    <label class="fg-label">Téléphone</label>
                                </div>
                            </div>

                            <p class="error center" ng-show="vm.error.profile.flag">
                                {{vm.error.profile.message}}
                            </p>

                            <div class="profile-box-footer">
                                <div class="profile-box-footer-btn-fr" ng-click="vm.showProfileEditPopup = true">
                                    Save
                                </div>
                                <div class="profile-box-footer-btn-fr cancel" ng-click="vm.cancelProfile()">
                                    Cancel
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="menu-category profile-about">
                        <div class="profile-box">
                            <p>
                                About me
                            </p>
                            <md-input-container class="md-block h-a mb-0">
                                <label></label>
                                <textarea
                                    placeholder="Dévrivez vous ainsi que vos méthodes de travail. Expliquez à vos clients pourquoi ils doivent vous embuacher plutôt qu’un autre artisan."
                                    ng-model="vm.about.aboutMe" ng-class="{'border-red': !vm.about.aboutMe}"
                                    md-select-on-focus></textarea>
                            </md-input-container>
                            <div class="profile-box-footer">
                                <div class="profile-box-footer-btn-fr" ng-click="vm.updateAboutMe()">
                                    Save
                                </div>
                                <div class="profile-box-footer-btn-fr cancel" ng-click="vm.cancelAboutMe()">
                                    Cancel
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="menu-category profile-bck-verif">
                        <div class="profile-box">
                            <p>
                                Background verification
                            </p>

                            <div class="row">
                                <div class="col-xs-2 profile-verif">
                                    <input id="profile-back-verif-1" type="checkbox"
                                           ng-checked="vm.indexOfObject('BUSINESS_REGISTRATION', 'name', vm.verifications).length > 0"
                                           disabled="disabled">
                                    <label for="profile-back-verif-1"></label>
                                </div>
                                <div class="col-xs-10">
                                    <p>
                                        Extrait KBIS / SIRET
                                    </p>
                                    <a ngf-select="vm.uploadVerifications($files, $invalidFiles, 0)"
                                       ngf-accept="'image/*,application/pdf'" ngf-max-size="5MB"
                                       ng-click="vm.setVerif('BUSINESS_REGISTRATION')"><p>
                                        <span
                                            ng-if="vm.indexOfObject('BUSINESS_REGISTRATION', 'name', vm.verifications).length == 0">Add</span>
                                        <span
                                            ng-if="vm.indexOfObject('BUSINESS_REGISTRATION', 'name', vm.verifications).length > 0">Change</span>
                                    </p></a>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-2 profile-verif">
                                    <input id="profile-back-verif-2" type="checkbox"
                                           ng-checked="vm.indexOfObject('INSURANCE', 'name', vm.verifications).length > 0"
                                           disabled="disabled">
                                    <label for="profile-back-verif-2"></label>
                                </div>
                                <div class="col-xs-10">
                                    <p>
                                        Assurance
                                    </p>
                                    <a ngf-select="vm.uploadVerifications($files, $invalidFiles, 0)"
                                       ngf-accept="'image/*,application/pdf'" ngf-max-size="5MB"
                                       ng-click="vm.setVerif('INSURANCE')"><p>
                                        <span
                                            ng-if="vm.indexOfObject('INSURANCE', 'name', vm.verifications).length == 0">Add</span>
                                        <span
                                            ng-if="vm.indexOfObject('INSURANCE', 'name', vm.verifications).length > 0">Change</span>

                                    </p></a>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-2 profile-verif">
                                    <input id="profile-back-verif-3" type="checkbox"
                                           ng-checked="vm.indexOfObject('RGE', 'name', vm.verifications).length > 0"
                                           disabled="disabled">
                                    <label for="profile-back-verif-3"></label>
                                </div>
                                <div class="col-xs-10">
                                    <p>
                                        Attestation RGE
                                    </p>
                                    <a ngf-select="vm.uploadVerifications($files, $invalidFiles, 0)"
                                       ngf-accept="'image/*,application/pdf'" ngf-max-size="5MB"
                                       ng-click="vm.setVerif('RGE')"><p>
                                        <span
                                            ng-if="vm.indexOfObject('RGE', 'name', vm.verifications).length == 0">Add</span>
                                        <span ng-if="vm.indexOfObject('RGE', 'name', vm.verifications).length > 0">Change</span>
                                    </p></a>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-2 profile-verif">
                                    <input id="profile-back-verif-4" type="checkbox"
                                           ng-checked="vm.indexOfObject('PARTNER', 'name', vm.verifications).length > 0"
                                           disabled="disabled">
                                    <label for="profile-back-verif-4"></label>
                                </div>
                                <div class="col-xs-10">
                                    <p>
                                        Main partner (EDF, Leroy Merlin, ...)
                                    </p>
                                    <a ngf-select="vm.uploadVerifications($files, $invalidFiles, 0)"
                                       ngf-accept="'image/*,application/pdf'" ngf-max-size="5MB"
                                       ng-click="vm.setVerif('PARTNER')">
                                        <p>
                                            <span
                                                ng-if="vm.indexOfObject('PARTNER', 'name', vm.verifications).length == 0">Add</span>
                                            <span
                                                ng-if="vm.indexOfObject('PARTNER', 'name', vm.verifications).length > 0">Change</span>
                                        </p></a>
                                </div>
                            </div>
                            <p class="error center" ng-show="vm.error.verif.flag">
                                {{vm.error.verif.message}}
                            </p>

                            <div class="profile-box-footer">
                                <div class="profile-box-footer-btn-fr" ng-click="vm.showVerificationsEditPopup = true">
                                    Save
                                </div>
                                <div class="profile-box-footer-btn-fr cancel" ng-click="vm.cancelVerifications()">
                                    Cancel
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="menu-category profile-about">
                        <div class="profile-box">
                            <p>
                                Change password
                            </p>
                            <md-input-container class="md-block mt-10" flex-gt-sm="">
                                <label>Current password</label>
                                <input type="password" ng-model="vm.pwdCurrent">
                            </md-input-container>
                            <md-input-container class="md-block mt-10" flex-gt-sm="">
                                <label>New password</label>
                                <input type="password" ng-model="vm.pwd1">
                            </md-input-container>
                            <md-input-container class="md-block mt-10" flex-gt-sm="">
                                <label>Confirm password</label>
                                <input type="password" ng-model="vm.pwd2" ng-class="{'border-red': vm.pwd1 != vm.pwd2}">
                            </md-input-container>
                            <p class="error center" ng-show="vm.error.password.flag">
                                {{vm.error.password.message}}
                            </p>

                            <div class="profile-box-footer mt-12">
                                <div class="profile-box-footer-btn-fr" ng-click="vm.changePassword()">
                                    Save
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="col-md-6">

                    <div class="menu-category profile-area">
                        <div class="profile-box">
                            <div class="profile-area-header">
                                <p>
                                    Notification area
                                </p>

                                <p class="profile-area-header-info">
                                    Zoom and center the map to define your notification area : you will be notified of
                                    all works
                                    in this area.
                                </p>
                            </div>
                            <div id="map_canvas">
                                <ui-gmap-google-map center="vm.map.center" control="vm.map.control"
                                                    bounds="vm.map.bounds" zoom="vm.map.zoom" options="vm.mapOptions"
                                                    events="vm.map.events">
                                    <ui-gmap-circle center="vm.circle.center" stroke="vm.circle.stroke"
                                                    fill="vm.circle.fill" radius="vm.circle.radius"
                                                    bounds="vm.circle.bounds"
                                                    visible="vm.circle.visible" geodesic="true" editable="false"
                                                    draggable="false" clickable="true" control="vm.circle.control"
                                                    events="vm.circle.events"></ui-gmap-circle>
                                </ui-gmap-google-map>
                                <div class="mapMinimumZoomMessage" ng-show="vm.mapShowMinimumZoomMessage">
                                    Please zoom in to define your notification area
                                </div>
                                <div class="workareaDiameter"
                                     ng-show="vm.workareaDiameter != 0 && !vm.mapShowMinimumZoomMessage">
                                    Area diameter : {{vm.workareaDiameter}} km
                                </div>
                            </div>
                            <div class="profile-box-footer">
                                <div class="profile-box-footer-btn-fr" ng-click="vm.updateWorkArea()">
                                    Save
                                </div>
                                <div class="profile-box-footer-btn-fr cancel" ng-click="vm.cancelWorkArea()">
                                    Cancel
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="menu-category profile-about">
                        <div class="profile-box">
                            <p>
                                Portfolio
                            </p>

                            <div class="row cl">
                                <div class="col-md-3" ng-repeat="pict in vm.portfolio" title="{{pict.description}}">
                                    <cl-image public-id="{{pict.cloudinaryPublicId}}"
                                              secure="true" format="png" class="center">
                                        <cl-transformation height="92" width="92" crop="fill"/>
                                    </cl-image>
                                </div>
                                <div class="col-md-3 no-padding"
                                     ngf-drop="vm.uploadPortfolio($files)"
                                     ngf-drag-over-class="dragOverClass($event)"
                                     ng-model="files"
                                     ng-multiple="false" ng-if="vm.portfolio.length < 10 || !vm.portfolio">
                                    <div class="add-img-edit center "
                                         ngf-select="vm.uploadPortfolio($files, $invalidFiles, 0)"
                                         ngf-accept="'image/*'" ngf-max-size="5MB">
                                        <img class="center-middle" src="icons/mdpi/ic_new_request.png" alt=""/>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-box-footer">
                                <div class="profile-box-footer-btn-fr" ng-click="vm.updatePortfolio()">
                                    Save
                                </div>
                                <div class="profile-box-footer-btn-fr cancel" ng-click="vm.cancelPortfolio()">
                                    Cancel
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="menu-category profile-about">
                        <div class="profile-box">
                            <p>
                                Jobs categories & skills
                            </p>

                            <div class="row">
                                <div class="col-xs-6 mb-15 cursor-pointer" ng-repeat="s in vm.cat"
                                     ng-click="vm.actionActivities(s)">
                                    <div class="row profile-activities no-margin">
                                        <div class="col-xs-3 no-padding"
                                             ng-show="vm.indexOfObject(s, 'code', vm.activities).length > 0">
                                            <div class="profile-activities-check">
                                                <span class="glyphicon glyphicon-ok"></span>
                                            </div>
                                        </div>
                                        <div class="col-xs-3 no-padding"
                                             ng-show="vm.indexOfObject(s, 'code', vm.activities).length == 0">
                                            <span>-</span>
                                        </div>
                                        <div class="col-xs-9 no-padding">
                                            {{ 'ACTIVITY_' + s | translate}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p class="error center" ng-show="vm.error.activities.flag">
                                {{vm.error.activities.message}}
                            </p>

                            <div class="profile-box-footer">
                                <div class="profile-box-footer-btn-fr" ng-click="vm.updateActivities()">
                                    Save
                                </div>
                                <div class="profile-box-footer-btn-fr cancel" ng-click="vm.cancelActivities()">
                                    Cancel
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="yakaPopup" ng-show="vm.showProfileEditPopup || vm.showVerificationsEditPopup" ng-click="vm.closePopup()"
     ng-cloak>
    <div class="container">
        <div class="yakaPopupWindow col-xs-12" ng-click="$event.stopPropagation()">
            <img class="popupCloseButton"
                 src="icons/mdpi/ic_popup_close.png"
                 ng-click="vm.closePopup()"
                 alt=""/>

            <div class="profilePopupMessage">
                Vous allez modifier des éléments importants de votre profil Pro, vous ne pourrez plus répondre à de
                nouvelles offres tant qu'il n'aura pas été revalidé par l'équipe YakaClub (vous recevrez un mail
                rapidement pour vous en tenir informé).
            </div>
            <div class="col-xs-6 yakaButton yakaBlue profilePopupButton" ng-click="vm.closePopup()">
                ANNULER
            </div>
            <div class="col-xs-6 yakaButton yakaBlue profilePopupButton" ng-click="vm.validatePopup()">
                VALIDER
            </div>
        </div>
    </div>
</div>
