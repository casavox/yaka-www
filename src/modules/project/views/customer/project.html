<style type="text/css">
    #map_canvas {
        height: 120px;
        margin: 0px;
        margin-left: -15px;
        margin-right: -15px;
    }

    #map_canvas {
        position: relative;
    }

    .angular-google-map-container {
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
    }

</style>

<header id="header" data-current-skin="{{app.getTheme()}}" ng-include="'/modules/core/views/header.html'"></header>

<section id="main">

    <aside id="sidebar" data-ng-include="'/modules/core/views/sidebar-left.html'"
           data-ng-class="{ 'toggled': app.sidebarToggle.left }"></aside>

    <div id="content" class="content">
        <div class="container">
            <div class="card">
                <div class="row no-margin">
                    <div class="col-xs-12">
                        <div class="description-action-btn" ng-click="vm.edit()" ng-show="!vm.editFlag">
                            MODIFIER
                        </div>
                        <div class="description-action-btn" ng-show="!vm.editFlag" ng-click="vm.trashFlag = true">
                            SUPPRIMER
                        </div>
                        <div class="description-action-btn color-red" ng-show="vm.editFlag"
                             ng-click="vm.saveFlag = true">
                            ENREGISTER
                        </div>
                        <div class="description-action-btn" ng-show="vm.editFlag" ng-click="vm.cancel()">
                            ANNULER
                        </div>
                        <div class="description-date">
                            Mis à jour <span am-time-ago="vm.project.updated"></span>
                        </div>
                    </div>
                </div>
                <div class="row no-margin">
                    <div class="col-xs-12 ">
                        <div id="map_canvas">
                            <ui-gmap-google-map center="map.center" zoom="map.zoom" options="mapOptions"
                                                dragging="false">
                                <ui-gmap-marker idKey='1' coords='vm.markerCoords'></ui-gmap-marker>
                            </ui-gmap-google-map>
                        </div>
                    </div>
                </div>
                <div class="row no-margin" title="{{vm.projectTmp.address.address}}">
                    <div class="col-xs-12 row no-margin">
                        <div class="col-xs-12 description-sub-title">
                            Où
                            <span class="icon-pen-blue" ng-show="vm.editFlag" ng-click="vm.editWhere()"></span>
                        </div>
                        <div class="col-xs-12 description-sub-text">
                            {{vm.projectTmp.address.name}} - {{vm.projectTmp.address.streetNumber}}
                            {{vm.projectTmp.address.route}}, {{vm.projectTmp.address.postalCode}}
                        </div>

                    </div>
                </div>
                <div class="row no-margin">
                    <div class="col-xs-12 row no-margin">
                        <div class="col-xs-12 description-sub-title">
                            Quand
                            <span class="icon-pen-blue" ng-show="vm.editFlag" ng-click="vm.editWhen()"></span>
                        </div>
                        <div class="col-xs-12 description-sub-text">
                            Début souhaité {{vm.getWhen()}}
                        </div>
                    </div>
                </div>
                <div class="row no-margin">
                    <div class="col-xs-12 row no-margin">
                        <div class="col-xs-12 description-sub-title">
                            Mots clés
                        </div>
                        <div class="col-xs-12 description-sub-text">
                            {{vm.getTags() | yakaTranslateTags}}
                        </div>
                    </div>
                </div>
                <div class="row no-margin">
                    <div class="col-xs-12 row no-margin">
                        <div class="col-xs-12 description-sub-title">
                            Description
                        </div>
                        <div class="col-xs-12 description-sub-text">
                                <textarea msd-elastic class="custom-textarea" disabled
                                          ng-model="vm.projectTmp.description" ng-hide="vm.editFlag"></textarea>


                            <form class="descriptionFormProject" ng-show="vm.editFlag" name="descriptionForm">
                                <div class="form-group"
                                     ng-class="{'has-error': !vm.projectTmp.description}">
                                    <div class="fg-line">
                                    <textarea class="form-control" rows="2"
                                              name="description"
                                              ng-model="vm.projectTmp.description"
                                              required="required"
                                              ng-minlength="5"
                                              data-auto-size
                                              data-autosize-on="true"
                                              placeholder=""></textarea>
                                    </div>
                                    <div ng-messages="descriptionForm.description.$error">
                                        <small class="help-block" ng-message="required">Ce champ est requis</small>
                                        <small class="help-block" ng-message="minlength">La description est trop
                                            courte
                                        </small>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="row no-margin"
                     ng-if="(vm.projectTmp.images && vm.projectTmp.images.length > 0) || vm.editFlag">
                    <div class="col-xs-12 row no-margin">
                        <div class="col-xs-12 description-sub-title">
                            Photos
                        </div>

                        <div class="col-xs-12 description-sub-text row mb-15 m-t-15">

                            <!--Viewing mode-->

                            <div class="lightbox photos projectImageTooltip" ng-show="!vm.editFlag">
                                <div data-src="{{image.cloudinaryPublicId | yakaCloudinaryUrl}}"
                                     data-sub-html="#caption{{$index}}"
                                     class="lightboxItemAngular col-md-3 col-sm-3 col-xs-6"
                                     tooltip-placement="top"
                                     uib-tooltip="{{image.description}}"
                                     ng-repeat="image in vm.projectTmp.images">
                                    <div class="lightbox-item p-item">
                                        <img ng-src="{{image.cloudinaryPublicId | yakaCloudinaryUrl:true}}"
                                             alt=""/>
                                    </div>
                                    <div id="caption{{$index}}" style="display:none">
                                        <div class="galleryCaption">
                                            <p>{{image.description}}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--Editing mode-->

                            <div class="" ng-show="vm.editFlag" ng-show="vm.editFlag">
                                <div class="galleryEditingItem col-md-3 col-sm-3 col-xs-6"
                                     ng-repeat="image in vm.projectTmp.images">
                                    <div class="lightbox-item p-item projectImageTooltip">
                                        <img
                                            tooltip-placement="top"
                                            uib-tooltip="{{image.description}}"
                                            ng-src="{{image.cloudinaryPublicId | yakaCloudinaryUrl:true}}"
                                            alt=""/>
                                    </div>

                                    <div class="dropdown pmop-message pmop-message-icon-left" uib-dropdown>
                                        <button uib-dropdown-toggle class="btn bgm-lightblue btn-float">
                                            <i class="zmdi zmdi-comment-text-alt"></i>
                                        </button>

                                        <div class="dropdown-menu stop-propagate">
                                                <textarea placeholder="Ajouter un commentaire"
                                                          ng-model="image.description"
                                                          ng-maxlength="140"
                                                          maxlength="140"
                                                          data-auto-size
                                                          ng-trim="false"
                                                          ng-change="vm.descriptionChanged(image)"></textarea>

                                            <div class="descriptionCounter">
                                                {{vm.getStringLength(image.description)}} / 140 caractères
                                            </div>

                                            <button class="btn bgm-lightblue btn-float"
                                                    data-tl-action="save"
                                                    ng-click="vm.saveComment();">
                                                <i class="zmdi zmdi-check"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <button class="floatingButton btn btn-danger btn-float"
                                            ng-click="vm.removeImage($index)">
                                        <i class="zmdi zmdi-delete"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="col-md-3 col-sm-3 col-xs-6 no-padding"
                                 ngf-drop="vm.uploadFiles($files)"
                                 ngf-drag-over-class="dragOverClass($event)"
                                 ng-model="files"
                                 ng-multiple="false" ng-show="vm.editFlag">
                                <div class="galleryUpload lightbox-item p-item"
                                     ngf-select="vm.uploadFiles($files, $invalidFiles, 0)"
                                     ngf-accept="'image/*'" ngf-max-size="5MB">
                                    <div class="content">
                                        <i class="zmdi zmdi-plus-circle-o"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="popUp" ng-show="vm.trashFlag">
        <div class="popUp-container center-middle">
            <div class="popUp-content">
                <span class="boxclose" ng-click="vm.trashFlag = false"></span>
                <h4>Êtes-vous sûr ?</h4>
                <p>Il est en général préférable de modifier un projet.</p>
            </div>
            <div class="popUp-footer">
                <div ng-click="vm.trashFlag = false">
                    ANNULER
                </div>
                <div ng-click="vm.deleteProject()">
                    SUPPRIMER DÉFINITIVEMENT
                </div>
            </div>
        </div>
    </div>

    <div class="popUp" ng-show="vm.closeFlag">
        <div class="popUp-container center-middle">
            <div class="popUp-content">
                <span class="boxclose" ng-click="vm.closeFlag = false"></span>
                <h4>Clore le projet</h4>
                <p>Les travaux sont terminés et payés.</p>
            </div>
            <div class="popUp-footer">
                <div ng-click="vm.trashFlag = false">
                    ANNULER
                </div>
                <div ng-click="vm.closeProject()">
                    CONFIRMER
                </div>
            </div>
        </div>
    </div>

    <div class="popUp" ng-show="vm.saveFlag">
        <div class="popUp-container center-middle">
            <div class="popUp-content">
                <span class="boxclose" ng-click="vm.saveFlag = false"></span>
                <h4>Êtes-vous sûr ?</h4>
                <p>
                    Si des propositions vous ont déjà été faites, les Pro concernés en seront notifiés, en fonction de
                    vos modifications ils pourront décider de modifier ou retirer leur proposition.
                </p>
            </div>
            <div class="popUp-footer">
                <div ng-click="vm.cancel()">
                    ANNULER
                </div>
                <div ng-click="vm.update()">
                    METTRE À JOUR
                </div>
            </div>
        </div>
    </div>

    <div class="popUp img-preview-size" ng-show="vm.imageFlag" ng-click="vm.imageFlag = false">
        <div class="popUp-container center-middle w-90p h-90p" ng-click="$event.stopPropagation()">
            <div class="popUp-content img-preview-popUp">
                <span class="boxclose" ng-click="vm.imageFlag = false"></span>
                <h4>Delete or Update description</h4>
                <cl-image public-id="{{vm.imgTmp.cloudinaryPublicId}}"
                          secure="true" format="png" class="center mb-39">
                </cl-image>
                <textarea class="custom-textarea-image bt-20" ng-model="vm.imgTmp.description"
                          ng-change="vm.limitLength(vm.imgTmp, 'description', 140)"></textarea>

                <div class="img-desc-length">
                    {{vm.imgTmp.description.length}}/140
                </div>
            </div>
            <div class="popUp-footer">
                <div ng-click="vm.deleteImg()">
                    DELETE
                </div>
                <div ng-click="vm.updateImg()">
                    UPDATE
                </div>
            </div>
        </div>
    </div>

    <div class="popUp img-preview-size" ng-show="vm.imagePreviewFlag" ng-click="vm.imagePreviewFlag = false">
        <div class="popUp-container center-middle" ng-click="$event.stopPropagation()">
            <div class="popUp-content no-margin img-preview-popUp">
                <span class="boxclose" ng-click="vm.imagePreviewFlag = false"></span>
                <h4>Preview</h4>
                <cl-image public-id="{{vm.imgTmpPreview.cloudinaryPublicId}}"
                          secure="true" format="png" class="center">
                </cl-image>
                <textarea class="custom-textarea-image bt-20" ng-model="vm.imgTmpPreview.description"
                          disabled></textarea>
            </div>
        </div>
    </div>

    <div class="popUp" ng-show="vm.whereFlag">
        <div class="popUp-container center-middle w-550">
            <div class="popUp-content">
                <span class="boxclose" ng-click="vm.whereFlag = false"></span>
                <h4>Lieu des travaux ?</h4>

                <div class="row no-margin w-900 center select-addr" ng-show="vm.user.addresses.length > 0">
                    <div class="col-md-4 no-padding">
                        <select class="select-custom" ng-model="vm.myAddress" ng-change="vm.setAddress()">
                            <option value="new">Create new one</option>
                            <option ng-repeat="a in vm.user.addresses" value="{{a.address}}"
                                    ng-selected="{{a.address.toString() == vm.myAddress.toString()}}">{{a.name}}
                            </option>
                        </select>
                    </div>
                    <div class="col-md-4 no-padding">
                        <p class="">
                            - Ou ajouter une nouvelle adresse
                        </p>
                    </div>
                    <div class="col-md-4 no-padding">
                        <input type="text" class="select-custom" ng-model="vm.newAddr.name"
                               ng-change="vm.verifNameAddr()" placeholder="Nom de l'adresse (Maison, Papa, ...)">
                    </div>
                </div>
                <div class="row no-margin w-900 center addr">
                    <div class="col-xs-3" ng-show="vm.newAddrFlag">
                        <input type="text" class="select-custom" ng-model="vm.newAddr.name"
                               ng-change="vm.verifNameAddr()" placeholder="Nom de l'adresse (Maison, Papa, ...)">
                    </div>
                    <div class="no-padding mb-39"
                         ng-class="{'col-xs-12': !vm.newAddrFlag, 'col-xs-9': vm.newAddrFlag}">
                        <div class="inner-addon right-addon">
                            <div class="disabled-addr" ng-show="vm.disabledAddr"></div>
                            <i class="glyphicon glyphicon-map-marker"></i>
                            <input vs-google-autocomplete="options"
                                   options="options"
                                   ng-model="address.name"
                                   vs-place="address.place"
                                   vs-place-id="address.components.placeId"
                                   vs-street-number="address.components.streetNumber"
                                   vs-street="address.components.street"
                                   vs-city="address.components.city"
                                   vs-state="address.components.state"
                                   vs-country-short="address.components.countryCode"
                                   vs-country="address.components.country"
                                   vs-post-code="address.components.postCode"
                                   vs-district="address.components.district"
                                   vs-latitude="address.components.location.lat"
                                   vs-longitude="address.components.location.long"

                                   type="text"
                                   name="address"
                                   id="address"
                                   placeholder="Indiquer l'adresse" class="input-custom">
                        </div>
                    </div>
                </div>
            </div>
            <div class="popUp-footer">
                <div ng-click="vm.whereFlag = false">
                    ANNULER
                </div>
                <div ng-click="vm.changeWhere()">
                    CONFIRMER
                </div>
            </div>
        </div>
    </div>

    <div class="popUp" ng-show="vm.whenFlag">
        <div class="popUp-container center-middle w-500">
            <div class="popUp-content">
                <span class="boxclose" ng-click="vm.whenFlag = false"></span>
                <h4>Quand voulez-vous que les travaux commencent ?</h4>
                <div>
                    <ul class="questions-ul center no-padding">
                        <li class="question-li center" ng-class="vm.child3"
                            ng-click="vm.selectDateType('NONE'); vm.child0 = ''; vm.child1 = ''; vm.child2 = ''; vm.child3 = 'activate'">
                            Dès que possible
                        </li>
                        <li class="question-li center" ng-class="vm.child2"
                            ng-click="vm.selectDateType('WITHIN_A_MONTH'); vm.child0 = ''; vm.child1 = ''; vm.child2 = 'activate'; vm.child3 = ''">
                            Dans le mois
                        </li>
                        <li class="question-li center" ng-class="vm.child0"
                            ng-click="vm.selectDateType('SPECIFIC'); vm.selectDate(); vm.child0 = 'activate'; vm.child1 = ''; vm.child2 = ''; vm.child3 = ''">
                            À partir d'une date
                        </li>
                        <li ng-show="vm.dateSelected" class="custom-li-date question-li center"
                            ng-click="vm.unSelectdate()">
                            {{vm.dt | date:'dd-MM-yyyy'}}
                        </li>
                        <li ng-show="vm.dateFlag" class="list-style-none">
                            <div style="display:inline-block; min-height:290px;" class="center custom-picker">
                                <uib-datepicker ng-model="vm.dt" datepicker-options="vm.datepickerOptions"
                                                class="well well-sm custom-date"
                                                custom-class="getDayClass(date, mode)"></uib-datepicker>
                            </div>
                        </li>
                    </ul>
                    <p class="error center" ng-show="vm.error.date.flag">
                        {{vm.error.date.message}}
                    </p>
                </div>
            </div>
            <div class="popUp-footer">
                <div ng-click="vm.whenFlag = false">
                    ANNULER
                </div>
                <div ng-click="vm.changeWhen()">
                    CONFIRMER
                </div>

            </div>
        </div>
    </div>
</section>
