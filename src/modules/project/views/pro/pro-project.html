<style type="text/css">
    #map_canvas {
        height: 120px;
        margin: 0px;
        margin-left: -15px;
        margin-right: -15px;
    }

    #map_canvas {
        position: relative;
    }

    .angular-google-map-container {
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
    }
</style>

<header id="header" data-current-skin="{{app.getTheme()}}" ng-include="'/modules/core/views/header.html'"
    ></header>

<section id="main">

    <aside id="sidebar" data-ng-include="'/modules/core/views/sidebar-left.html'"
           data-ng-class="{ 'toggled': app.sidebarToggle.left }"></aside>

    <div id="content" class="content col-xs-12">
        <div class="col-sm-8" ng-show="!vm.pro">
            <div class="card">
                <div class="row no-margin">
                    <div class="col-xs-12">
                        <p class="pro-title-post">
                            Mis à jour il y a {{vm.dateDiff(vm.projectTmp.updated)}}
                        </p>

                        <cl-image public-id="{{vm.projectTmp.user.avatar.cloudinaryPublicId}}"
                                  class="img-circle pro-icon-medium mt-20 fl-l ml-15" format="png"
                                  ng-if="vm.projectTmp.user.avatar.cloudinaryPublicId">
                            <cl-transformation height="40" width="40" crop="fill"/>
                        </cl-image>
                        <div class="img-default-medium mt-20 fl-l ml-15"
                             ng-if="!vm.projectTmp.user.avatar.cloudinaryPublicId">
                            {{vm.projectTmp.user.firstName[0] | uppercase}}.
                            {{vm.projectTmp.user.lastName[0]| uppercase}}.
                        </div>

                        <div class="pro-proposal-title">
                            <p ng-class="{'red': vm.projectTmp.type == 'EMERGENCY'}">
                                {{vm.project.translatedTitle}}
                            </p>

                            <p>
                                {{vm.projectTmp.user.firstName}} {{vm.projectTmp.user.lastName}}
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row no-margin">
                    <div class="col-xs-12 ">
                        <div id="map_canvas">
                            <ui-gmap-google-map center="map.center" zoom="map.zoom" options="mapOptions"
                                                dragging="false">
                                <ui-gmap-circle center="vm.circle.center" stroke="vm.circle.stroke"
                                                fill="vm.circle.fill" radius="vm.circle.radius"
                                                bounds="vm.circle.bounds"
                                                visible="vm.circle.visible" geodesic="true" editable="false"
                                                draggable="false" clickable="true" control="vm.circle.control"
                                                events="vm.circle.events"></ui-gmap-circle>
                            </ui-gmap-google-map>
                        </div>
                    </div>
                </div>
                <div class="row no-margin">
                    <div class="col-xs-12 row no-margin">
                        <div class="col-xs-12 description-sub-title">
                            Where
                            <span class="icon-pen-blue" ng-show="vm.editFlag" ng-click="vm.editWhere()"></span>
                        </div>
                        <div class="col-xs-12 description-sub-text">
                            {{vm.projectTmp.address.locality}} {{vm.projectTmp.address.postalCode}}
                        </div>
                    </div>
                </div>
                <div class="row no-margin">
                    <div class="col-xs-12 row no-margin">
                        <div class="col-xs-12 description-sub-title">
                            When
                            <span class="icon-pen-blue" ng-show="vm.editFlag" ng-click="vm.editWhen()"></span>
                        </div>
                        <div class="col-xs-12 description-sub-text">
                                <textarea msd-elastic class="custom-textarea" disabled
                                          ng-model="vm.whenSlot"></textarea>
                        </div>
                    </div>
                </div>
                <div class="row no-margin">
                    <div class="col-xs-12 row no-margin">
                        <div class="col-xs-12 description-sub-title">
                            Tags
                        </div>
                        <div class="col-xs-12 description-sub-text">
                            <span class="red" ng-show="vm.projectTmp.type == 'EMERGENCY'">Emergency</span>
                            {{vm.getTags()}}
                        </div>
                    </div>
                </div>
                <div class="row no-margin">
                    <div class="col-xs-12 row no-margin">
                        <div class="col-xs-12 description-sub-title">
                            Description
                        </div>
                        <div class="col-xs-12 description-sub-text">
                            <textarea msd-elastic class="custom-textarea" disabled
                                      ng-model="vm.projectTmp.description"></textarea>
                        </div>
                    </div>
                </div>
                <div class="row no-margin" ng-if="vm.projectTmp.images && vm.projectTmp.images.lenght != 0">
                    <div class="col-xs-12 row no-margin">
                        <div class="col-xs-12 description-sub-title">
                            Photos
                        </div>
                        <div class="col-xs-12 description-sub-text row mb-15 m-t-15">
                            <div class="col-xs-3" ng-repeat="media in vm.projectTmp.images"
                                 title="{{media.description}}" ng-click="vm.selectImagePreview(media)">
                                <span class="center-middle img-comment" ng-show="media.description"
                                      ng-click="vm.editImage(media)"></span>
                                <cl-image public-id="{{media.cloudinaryPublicId}}" secure="true" format="png"
                                          class="center"
                                          ng-click="vm.editImage(media)" ng-class="{'hover-border': vm.editFlag}">
                                    <cl-transformation height="92" width="92" crop="fill"/>
                                </cl-image>
                            </div>
                            <div class="col-md-3 no-padding"
                                 ngf-drop="vm.uploadFiles($files)"
                                 ngf-drag-over-class="dragOverClass($event)"
                                 ng-model="files"
                                 ng-multiple="false" ng-show="vm.editFlag">
                                <div class="add-img-edit center"
                                     ngf-select="vm.uploadFiles($files, $invalidFiles, 0)"
                                     ngf-accept="'image/*'" ngf-max-size="5MB">
                                    <img class="center-middle" src="icons/mdpi/ic_new_request.png" alt=""/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-4" ng-show="vm.proposal.status != 'SELECTED'">

            <div class="block-header">
                <h2>Mon offre</h2>
            </div>

            <div class="card col-xs-12 makeOfferBox">

                <div class="row" ng-if="!vm.project.error">
                    <div class="col-xs-12 cursor-pointer" ng-click="vm.myPrice()">
                        <span class="icon-pen-blue-pro"></span>
                        <span class="price-area" ng-show="!vm.offer.price.price">---</span>
                        <span class="price-area" ng-show="vm.offer.price.price">{{vm.offer.price.type}}. {{vm.offer.price.price}} €</span>

                        <p class="pro-menu-title">
                            My price
                        </p>

                        <p class="pro-menu-subTitle">
                            Tell your price condition
                        </p>
                    </div>
                    <div class="col-xs-12 cursor-pointer" ng-click="vm.myDate()">
                        <span class="icon-pen-blue-pro"></span>
                        <span class="price-area" ng-show="!vm.offer.date.date">---</span>
                    <span class="price-area" ng-show="vm.offer.date.date"><span
                        ng-if="vm.projectTmp.type != 'EMERGENCY'">{{vm.offer.date.date | date:'dd MMM yyyy'}}</span> <span
                        ng-if="vm.projectTmp.type == 'EMERGENCY'">{{vm.getSlot(vm.offer.date.slot)}}</span></span>

                        <p class="pro-menu-title">
                            My start date
                        </p>

                        <p class="pro-menu-subTitle">
                            Tell your customer when you
                            can start this job
                        </p>
                    </div>
                    <div class="col-xs-12">
                        <p class="pro-menu-title">
                            My message to the client
                        </p>
                    <textarea class="custom-textarea-red w-100p placeholder-xs mb-10"
                              ng-maxlength="140"
                              maxlength="140"
                              placeholder="Commentaire"
                              data-auto-size
                              ng-trim="false"
                              ng-model="vm.offer.comment"></textarea>

                        <div class="proCommentCounter">
                            {{vm.getStringLength(vm.offer.comment)}} / 140 caractères
                        </div>

                        <p class="error center makeOfferError" ng-show="vm.error.comment.flag">
                            {{vm.error.comment.message}}
                        </p>
                    </div>
                </div>
                <div class="row" ng-if="vm.project.error">
                    <div class="col-xs-12 proErrorMessage"
                         ng-if="vm.project.error == 'ERROR_FORBIDDEN_PRO_STATUS_REGISTERED' || vm.project.error == 'ERROR_FORBIDDEN_PRO_STATUS_REFUSED'">
                        Votre profil est incomplet, vous ne pouvez pas faire d'offre sur ce projet.
                    </div>

                    <div class="col-xs-10 col-xs-offset-1 yakaButton yakaOrange"
                         ng-if="vm.project.error == 'ERROR_FORBIDDEN_PRO_STATUS_REGISTERED'"
                         ui-sref="pro-profile">
                        COMPLÉTER MON PROFIL
                    </div>

                    <div class="col-xs-12 proErrorMessage"
                         ng-if="vm.project.error == 'ERROR_FORBIDDEN_PRO_STATUS_WAITING'">
                        Vous ne pouvez pas encore faire d'offre car votre profil est en cours de validation. Il sera
                        mis-à-jour sous peu, vous en serez notifié par mail
                    </div>
                </div>
                <button type="button" class="yakaButton yakaBlue col-xs-12 button btn send-offer"
                        ng-click="vm.sendOffer()">SEND OFFER
                </button>
            </div>
        </div>
    </div>

    <div class="popUp" ng-show="vm.myPriceFlag" ng-cloak>
        <div class="popUp-container center-middle w-330">
            <div class="popUp-content">
                <span class="boxclose" ng-click="vm.myPriceFlag = false"></span>
                <h4>My price</h4>

                <p class="info-popUp">
                </p>

                <p class="info-popUp-comp" ng-show="vm.projectTmp.type != 'EMERGENCY'">
                    Send an estimate or final price
                </p>

                <p class="info-popUp-comp" ng-show="vm.projectTmp.type == 'EMERGENCY'">
                    Send an hourly or flat price
                </p>

                <div class="row">
                    <div class="col-xs-10">
                        <input type="text" class="custom-input-number" min="0" step="1"
                               ng-model="vm.price"
                               ng-class="{'border-red': vm.projectTmp.type == 'EMERGENCY', 'mb-25': !vm.error.price.flag}"
                               yaka-input-numbers-only>
                    </div>
                    <div class="col-xs-2 sym-euro no-padding h-0">
                        €
                    </div>
                </div>
                <p class="error center my-price-error" ng-show="vm.error.price.flag">
                    {{vm.error.price.message}}
                </p>
            </div>

            <div class="clearfix" ng-show="vm.projectTmp.type != 'EMERGENCY'">
                <div class="pro-popUp-choice fl" ng-click="vm.selectPrice('Estimate')">
                    ESTIMATE
                </div>
                <div class="pro-popUp-choice fr" ng-click="vm.selectPrice('Final')">
                    FINAL
                </div>

            </div>
            <div class="clearfix" ng-show="vm.projectTmp.type == 'EMERGENCY'">
                <div class="pro-popUp-choice  fl" ng-click="vm.selectPrice('Hourly')">
                    HOURLY
                </div>
                <div class="pro-popUp-choice  fr" ng-click="vm.selectPrice('Flat')">
                    FLAT
                </div>
            </div>
        </div>
    </div>


    <div class="popUp" ng-show="vm.myDateFlag">
        <div class="popUp-container center-middle" ng-class="{'w-500': vm.project.type == 'EMERGENCY'}">
            <div class="popUp-content">
                <span class="boxclose" ng-click="vm.myDateFlag = false"></span>
                <h4>My start date</h4>

                <div ng-show="vm.project.type == 'EMERGENCY'">
                    <div class="row center no-margin w-500">
                        <div class="col-xs-12 row line-date">


                            <div class="col-xs-3">

                            </div>
                            <div class="col-xs-3 text-center">
                                {{vm.J1.date | date:"EEE"}}
                            </div>
                            <div class="col-xs-3 text-center">
                                {{vm.J2.date | date:"EEE"}}
                            </div>
                            <div class="col-xs-3 text-center">
                                {{vm.J3.date | date:"EEE"}}
                            </div>
                        </div>
                        <div class="col-xs-12 row line-date">
                            <div class="col-xs-3">
                                7h-9h
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J1.c1 = !vm.J1.c1; vm.J1.all = false"
                                     ng-class="vm.J1.c1Disabled" ng-init="vm.J1.c1 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J1.c1 && vm.J1.c1Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J2.c1 = !vm.J2.c1; vm.J2.all = false"
                                     ng-class="vm.J2.c1Disabled" ng-init="vm.J2.c1 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J2.c1 && vm.J2.c1Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J3.c1 = !vm.J3.c1; vm.J3.all = false"
                                     ng-class="vm.J3.c1Disabled" ng-init="vm.J3.c1 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J3.c1 && vm.J3.c1Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>

                        </div>
                        <div class="col-xs-12 row line-date">
                            <div class="col-xs-3">
                                9h-12h
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J1.c2 = !vm.J1.c2; vm.J1.all = false"
                                     ng-class="vm.J1.c2Disabled" ng-init="vm.J1.c2 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J1.c2 && vm.J1.c2Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J2.c2 = !vm.J2.c2; vm.J2.all = false"
                                     ng-class="vm.J2.c2Disabled" ng-init="vm.J2.c2 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J2.c2 && vm.J2.c2Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J3.c2 = !vm.J3.c2; vm.J3.all = false"
                                     ng-class="vm.J3.c2Disabled" ng-init="vm.J3.c2 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J3.c2 && vm.J3.c2Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>

                        </div>
                        <div class="col-xs-12 row line-date">
                            <div class="col-xs-3">
                                12h-14h
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J1.c3 = !vm.J1.c3; vm.J1.all = false"
                                     ng-class="vm.J1.c3Disabled" ng-init="vm.J1.c3 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J1.c3 && vm.J1.c3Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J2.c3 = !vm.J2.c3; vm.J2.all = false"
                                     ng-class="vm.J2.c3Disabled" ng-init="vm.J2.c3 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J2.c3 && vm.J2.c3Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J3.c3 = !vm.J3.c3; vm.J3.all = false"
                                     ng-class="vm.J3.c3Disabled" ng-init="vm.J3.c3 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J3.c3 && vm.J3.c3Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>

                        </div>
                        <div class="col-xs-12 row line-date">
                            <div class="col-xs-3">
                                14h-16h
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J1.c4 = !vm.J1.c4; vm.J1.all = false"
                                     ng-class="vm.J1.c4Disabled" ng-init="vm.J1.c4 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J1.c4 && vm.J1.c4Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J2.c4 = !vm.J2.c4; vm.J2.all = false"
                                     ng-class="vm.J2.c4Disabled" ng-init="vm.J2.c4 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J2.c4 && vm.J2.c4Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J3.c4 = !vm.J3.c4; vm.J3.all = false"
                                     ng-class="vm.J3.c4Disabled" ng-init="vm.J3.c4 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J3.c4 && vm.J3.c4Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 row line-date">
                            <div class="col-xs-3">
                                16h-18h
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J1.c5 = !vm.J1.c5; vm.J1.all = false"
                                     ng-class="vm.J1.c5Disabled" ng-init="vm.J1.c5 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J1.c5 && vm.J1.c5Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J2.c5 = !vm.J2.c5; vm.J2.all = false"
                                     ng-class="vm.J2.c5Disabled" ng-init="vm.J2.c5 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J2.c5 && vm.J2.c5Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J3.c5 = !vm.J3.c5; vm.J3.all = false"
                                     ng-class="vm.J3.c5Disabled" ng-init="vm.J3.c5 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J3.c5 && vm.J3.c5Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 row line-date">
                            <div class="col-xs-3">
                                18h-20h
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J1.c6 = !vm.J1.c6; vm.J1.all = false"
                                     ng-class="vm.J1.c6Disabled" ng-init="vm.J1.c6 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J1.c6 && vm.J1.c6Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J2.c6 = !vm.J2.c6; vm.J2.all = false"
                                     ng-class="vm.J2.c6Disabled" ng-init="vm.J2.c6 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J2.c6 && vm.J2.c6Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J3.c6 = !vm.J3.c6; vm.J3.all = false"
                                     ng-class="vm.J3.c6Disabled" ng-init="vm.J3.c6 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J3.c6 && vm.J3.c6Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 row line-date">
                            <div class="col-xs-3">
                                Après 20h
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J1.c7 = !vm.J1.c7; vm.J1.all = false"
                                     ng-class="vm.J1.c7Disabled" ng-init="vm.J1.c7 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J1.c7 && vm.J1.c7Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J2.c7 = !vm.J2.c7; vm.J2.all = false"
                                     ng-class="vm.J2.c7Disabled" ng-init="vm.J2.c7 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J2.c7 && vm.J2.c7Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>
                            <div class="col-xs-3">
                                <div class="checkbox-style center-middle"
                                     ng-click="vm.unSelectOther(); vm.J3.c7 = !vm.J3.c7; vm.J3.all = false"
                                     ng-class="vm.J3.c7Disabled" ng-init="vm.J3.c7 = false">
                                    <span class="glyphicon glyphicon-ok check"
                                          ng-show="vm.J3.c7 && vm.J3.c7Disabled != 'checkbox-disabled'"></span>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div ng-show="vm.project.type != 'EMERGENCY'">
                    <div style="display:inline-block; min-height:290px;" class="center custom-picker">
                        <uib-datepicker ng-model="vm.dt" datepicker-options="vm.datepickerOptions"
                                        class="well well-sm custom-date"
                                        custom-class="getDayClass(date, mode)"></uib-datepicker>
                    </div>
                </div>
            </div>
            <div class="popUp-footer">
                <div ng-click="vm.myDateFlag = false">
                    CANCEL
                </div>
                <div ng-click="vm.selectDate()">
                    CONFIRM
                </div>
            </div>
        </div>
    </div>


    <div class="popUp img-preview-size" ng-show="vm.imagePreviewFlag" ng-click="vm.imagePreviewFlag = false">
        <div class="popUp-container center-middle" ng-click="$event.stopPropagation()">
            <div class="popUp-content no-margin img-preview-popUp">
                <span class="boxclose" ng-click="vm.imagePreviewFlag = false"></span>
                <h4>Preview</h4>
                <cl-image public-id="{{vm.imgTmpPreview.cloudinaryPublicId}}" secure="true" format="png" class="center">
                </cl-image>
                <textarea class="custom-textarea-image bt-20" ng-model="vm.imgTmpPreview.description"
                          disabled></textarea>
            </div>
        </div>
    </div>


</section>
