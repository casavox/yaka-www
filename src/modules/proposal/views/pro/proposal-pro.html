<style type="text/css">
    #map_canvas {
        height: 120px;
        margin: 0px;
        margin-left: -15px;
        margin-right: -15px;
    }

    @media (max-width: 767px) {
        #map_canvas {
            height: 100px;
        }
    }

    #map_canvas {
        position: relative;
    }

    .angular-google-map-container {
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
    }
</style>


<header id="header" data-current-skin="{{app.getTheme()}}" data-ng-include="'/modules/core/views/header.html'"
    ></header>

<section id="main">

    <aside id="sidebar" data-ng-include="'/modules/core/views/sidebar-left.html'"
           data-ng-class="{ 'toggled': app.sidebarToggle.left }"></aside>

    <div id="content" class="content">

        <div class="container">

            <div class="block-header">
                <h2>{{vm.project.title | yakaTranslateTitle}}</h2>
            </div>

            <div class="yakaMain proposalMainView">
                <div class="card m-b-15 pro" id="profile-main" data-ng-class="{'no-scroll': vm.showChat}">
                    <div class="pm-overview pro hidden-xs">
                        <div class="mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside"
                             tabindex="0">
                            <div
                                style="position: relative; top: 0px; left: 0px; width: 100%;" dir="ltr">
                                <div class="pmo-pic">
                                    <div class="p-relative">
                                        <img class="img-responsive proAvatarProposalImage"
                                             data-ng-if="vm.project.user.avatar.cloudinaryPublicId"
                                             data-ng-src="{{vm.project.user.avatar.cloudinaryPublicId | yakaCloudinaryUrl:true:259}}"
                                             alt=""/>

                                        <div class="yakaAvatarInitialsProposal"
                                             data-ng-if="!vm.project.user.avatar.cloudinaryPublicId">
                                            {{vm.project.user.firstName[0] | uppercase}}.
                                            {{vm.project.user.lastName[0]| uppercase}}.
                                        </div>

                                        <cl-image
                                            public-id="{{vm.proposal.professional.mainPartner.cloudinaryPublicId}}"
                                            class="proposalProMainPartnerImg" format="png"
                                            data-ng-if="vm.proposal.professional.mainPartner.cloudinaryPublicId">
                                            <cl-transformation height="55" width="55" crop="fill" radius="max"/>
                                        </cl-image>

                                    </div>

                                    <div class="col-xs-12 no-padding pmo-stat proposalProName">
                                        <h2 class="yakaEllipsis">
                                            {{vm.project.user.firstName}}
                                            {{vm.project.user.lastName}}
                                        </h2>

                                        <button data-ng-click="vm.cancelProposalModal()"
                                                class="col-xs-offset-1 col-xs-10 btn btn-danger btn-icon-text waves-effect">
                                            <i class="zmdi zmdi-close"></i> Annuler ce devis
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pm-body clearfix">

                        <ul class="tab-nav tab-nav-proposal tn-justified">
                            <li heading="Home"
                                data-ng-class="{'active': !vm.showChat}">
                                <a href="" data-ng-click="vm.showChat = false" class="ng-binding">Détails</a>
                            </li>

                            <li heading="Profile"
                                data-ng-class="{'active': vm.showChat}">
                                <a href="" data-ng-click="vm.showChat = true; vm.scrollBottom = 1"
                                   class="ng-binding">Messages</a>
                            </li>
                        </ul>

                        <yaka-chat class="scrollViewChatProposal" data-ng-show="vm.showChat"
                                   scroll-bottom="{{vm.scrollBottom}}"
                                   chat-id="{{vm.proposal.chat.id}}"
                                   proposal-status="{{vm.proposal.status}}"
                                   user-me="app.getUser()"
                                   user-other="vm.proposal.project.user"></yaka-chat>

                        <div data-ng-show="!vm.showChat">

                            <div class="pm-overview pro visible-xs">
                                <div class="mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside"
                                     tabindex="0">
                                    <div
                                        style="position: relative; top: 0px; left: 0px; width: 100%;" dir="ltr">
                                        <div class="pmo-pic">
                                            <div class="p-relative">
                                                <img class="img-responsive proAvatarProposalImage"
                                                     data-ng-if="vm.project.user.avatar.cloudinaryPublicId"
                                                     data-ng-src="{{vm.project.user.avatar.cloudinaryPublicId | yakaCloudinaryUrl:true:259}}"
                                                     alt=""/>

                                                <div class="yakaAvatarInitialsProposal"
                                                     data-ng-if="!vm.project.user.avatar.cloudinaryPublicId">
                                                    {{vm.project.user.firstName[0] | uppercase}}.
                                                    {{vm.project.user.lastName[0]| uppercase}}.
                                                </div>

                                            </div>

                                            <div class="col-xs-12 no-padding pmo-stat proposalProName">
                                                <h2 class="yakaEllipsis">
                                                    {{vm.project.user.firstName}}
                                                    {{vm.project.user.lastName}}
                                                </h2>

                                                <button data-ng-click="vm.cancelProposalModal()"
                                                        class="col-xs-offset-1 col-xs-10 btn btn-danger btn-icon-text waves-effect cancelProposal">
                                                    <i class="zmdi zmdi-close"></i> Annuler ce devis
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row no-margin">
                                <div class="col-xs-12 ">
                                    <div id="map_canvas">
                                        <ui-gmap-google-map center="map.center" zoom="map.zoom" options="mapOptions"
                                                            dragging="false">
                                            <ui-gmap-circle
                                                data-ng-if="vm.proposalTmp.status != 'SELECTED' && vm.proposalTmp.status != 'RATE_PRO' && vm.proposalTmp.status != 'COMPLETED'"
                                                center="vm.circle.center" stroke="vm.circle.stroke"
                                                fill="vm.circle.fill" radius="vm.circle.radius"
                                                bounds="vm.circle.bounds"
                                                visible="vm.circle.visible" geodesic="true" editable="false"
                                                draggable="false" clickable="true" control="vm.circle.control"
                                                events="vm.circle.events"></ui-gmap-circle>
                                            <ui-gmap-marker
                                                data-ng-if="vm.proposalTmp.status == 'SELECTED' || vm.proposalTmp.status == 'RATE_PRO' || vm.proposalTmp.status == 'COMPLETED'"
                                                idKey='1' coords='vm.markerCoords'
                                                visible="vm.marker.visible"></ui-gmap-marker>
                                        </ui-gmap-google-map>
                                    </div>
                                </div>
                            </div>

                            <div class="pmb-block">
                                <div class="pmbb-header">
                                    <h2><i class="zmdi zmdi-assignment-o zmdi-hc-fw"></i> Mon devis</h2>
                                </div>
                                <div class="pmbb-body p-l-30">
                                    <div class="pmbb-view">
                                        <dl class="dl-horizontal">
                                            <dt class="yakaDisableEllipsis">Mon prix</dt>
                                            <dd class="l-h-18">
                                                {{vm.proposalTmp.price || '--'}} € <i
                                                class="zmdi zmdi-edit c-lightblue pointer f-s-20 v-align-bottom m-l-10"
                                                data-ng-click="vm.editPrice()"></i>
                                            </dd>
                                        </dl>
                                        <dl class="dl-horizontal">
                                            <dt class="yakaDisableEllipsis">Ma date d'intervention</dt>
                                            <dd class="l-h-18">
                                                {{(vm.proposalTmp.startDate | date: 'dd MMMM yyyy') || '--'}} <i
                                                class="zmdi zmdi-edit c-lightblue pointer f-s-20 v-align-botttom m-l-10"
                                                data-ng-click="vm.editDate()"></i>
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>

                            <div class="pmb-block">
                                <div class="pmbb-header">
                                    <h2><i class="zmdi zmdi-assignment zmdi-hc-fw"></i> Informations</h2>
                                </div>
                                <div class="pmbb-body p-l-30">
                                    <div class="pmbb-view">
                                        <dl class="dl-horizontal">
                                            <dt class="yakaDisableEllipsis">Description</dt>
                                            <dd>
                                                {{vm.projectTmp.description}}
                                            </dd>
                                        </dl>
                                        <dl class="dl-horizontal"
                                            data-ng-if="vm.getTags() && vm.getTags().length > 0">
                                            <dt class="yakaDisableEllipsis">Mots clés</dt>
                                            <dd>
                                                <ul class="yaka-chips">
                                                    <li data-ng-repeat="tag in vm.getTags()">
                                                        {{'ACTIVITY_' + tag | translate}}
                                                    </li>
                                                </ul>
                                            </dd>
                                        </dl>
                                        <dl class="dl-horizontal">
                                            <dt class="yakaDisableEllipsis">Date souhaitée des travaux</dt>
                                            <dd>
                                                Début souhaité {{vm.getWhen()}}
                                            </dd>
                                        </dl>
                                        <dl class="dl-horizontal">
                                            <dt class="yakaDisableEllipsis">Lieu du chantier</dt>
                                            <dd>
                                                <div data-ng-switch on="vm.proposal.status">
                                                    <span data-ng-switch-when="SELECTED" class="whiteSpacePre">{{vm.projectTmp.address.address}}</span>
                                                    <span data-ng-switch-when="RATE_PRO" class="whiteSpacePre">{{vm.projectTmp.address.address}}</span>
                                                    <span data-ng-switch-when="COMPLETED" class="whiteSpacePre">{{vm.projectTmp.address.address}}</span>
                                                    <span data-ng-switch-default class="whiteSpacePre">{{vm.projectTmp.address.postalCode}} {{vm.projectTmp.address.locality}}</span>
                                                </div>
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>

                            <div class="pmb-block clearfix"
                                 data-ng-if="vm.projectTmp.images && vm.projectTmp.images.length > 0">
                                <div class="pmbb-header">
                                    <h2><i class="zmdi zmdi-collection-image zmdi-hc-fw"></i> Photos</h2>
                                </div>
                                <div class="pmbb-body p-l-30">
                                    <div class="pmbb-view">
                                        <div class="lightbox photos projectImageTooltip" data-ng-show="!vm.editFlag">
                                            <div data-src="{{image.cloudinaryPublicId | yakaCloudinaryUrl}}"
                                                 data-sub-html="#caption{{$index}}"
                                                 class="lightboxItemAngular col-md-3 col-md-2 col-sm-3 col-xs-4"
                                                 tooltip-placement="top"
                                                 uib-tooltip="{{image.description}}"
                                                 data-ng-repeat="image in vm.projectTmp.images">
                                                <div class="lightbox-item p-item">
                                                    <img
                                                        data-ng-src="{{image.cloudinaryPublicId | yakaCloudinaryUrl:true}}"
                                                        alt=""/>
                                                </div>
                                                <div id="caption{{$index}}" style="display:none">
                                                    <div class="galleryCaption">
                                                        <p>{{image.description}}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="yakaPopup" data-ng-show="vm.myPriceFlag"
         data-ng-click="vm.myPriceFlag = false" data-ng-cloak>
        <div class="container">
            <div class="yakaPopupWindow col-xs-12" data-ng-click="$event.stopPropagation()">
                <img class="popupCloseButton" src="icons/mdpi/ic_popup_close.png"
                     data-ng-click="vm.myPriceFlag = false" alt=""/>
                <h4>Mon prix</h4>

                <div class="row">
                    <div class="col-xs-6 col-xs-offset-4">
                        <input type="text" class="form-control t-right f-s-18" id="exampleInputEmail2"
                               placeholder="Entrer un prix"
                               data-ng-model="vm.myPrice"
                               yaka-input-numbers-only>
                    </div>
                    <div class="col-xs-2 sym-euro">
                        €
                    </div>
                </div>
                <p class="error center my-price-error" data-ng-show="vm.error.price.flag">
                    {{vm.error.price.message}}
                </p>

                <div class="clearfix m-t-10 f-right">
                    <button class="btn bgm-lightblue waves-effect" data-ng-click="vm.selectPrice(); vm.save()">
                        Enregistrer
                    </button>
                </div>

            </div>
        </div>
    </div>


    <div class="yakaPopup" data-ng-show="vm.myDateFlag"
         data-ng-click="vm.myDateFlag = false" data-ng-cloak>
        <div class="container">
            <div class="yakaPopupWindow col-xs-12" data-ng-click="$event.stopPropagation()">
                <img class="popupCloseButton" src="icons/mdpi/ic_popup_close.png"
                     data-ng-click="vm.myDateFlag = false" alt=""/>
                <h4>Ma date d'intervention</h4>

                <div style="display:inline-block" class="center custom-picker">
                    <uib-datepicker data-ng-model="vm.dt" datepicker-options="vm.datepickerOptions"
                                    class="well well-sm custom-date"></uib-datepicker>
                </div>
                <div class="clearfix m-t-10 f-right">
                    <button class="btn bgm-lightblue waves-effect"
                            data-ng-click="vm.myDateFlag = false; vm.selectDate(); vm.save()">
                        Enregistrer
                    </button>
                </div>
            </div>
        </div>
    </div>

</section>
