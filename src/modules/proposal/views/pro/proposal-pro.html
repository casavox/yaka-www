<style type="text/css">
    #map_canvas {
        height: 120px;
        margin: 0px;
        margin-left: -15px;
        margin-right: -15px;
    }

    #map_canvas {
        position: relative;
    }

    .angular-google-map-container {
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
    }
</style>


<header id="header" data-current-skin="{{app.getTheme()}}" ng-include="'/modules/core/views/header.html'"
    ></header>

<section id="main">

    <aside id="sidebar" data-ng-include="'/modules/core/views/sidebar-left.html'"
           data-ng-class="{ 'toggled': app.sidebarToggle.left }"></aside>

    <div id="content" class="content">


        <div class="container">

            <div class="block-header">
                <h2>{{vm.project.title | yakaTranslateTitle}}</h2>
            </div>


            <div class="yakaMain proposalMainView">
                <div class="card m-b-15 pro" id="profile-main" data-ng-class="{'no-scroll': vm.showChat}">
                    <div class="pm-overview hidden-xs">
                        <div class="mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside"
                             tabindex="0">
                            <div
                                style="position: relative; top: 0px; left: 0px; width: 100%;" dir="ltr">
                                <div class="pmo-pic">
                                    <div class="p-relative">
                                        <img class="img-responsive proAvatarProposalImage"
                                             data-ng-if="vm.project.user.avatar.cloudinaryPublicId"
                                             data-ng-src="{{vm.project.user.avatar.cloudinaryPublicId | yakaCloudinaryUrl:true:259}}"
                                             alt=""/>

                                        <div class="yakaAvatarInitialsProposal"
                                             data-ng-if="!vm.project.user.avatar.cloudinaryPublicId">
                                            {{vm.project.user.firstName[0] | uppercase}}.
                                            {{vm.project.user.lastName[0]| uppercase}}.
                                        </div>

                                        <cl-image
                                            public-id="{{vm.proposal.professional.mainPartner.cloudinaryPublicId}}"
                                            class="proposalProMainPartnerImg" format="png"
                                            ng-if="vm.proposal.professional.mainPartner.cloudinaryPublicId">
                                            <cl-transformation height="55" width="55" crop="fill" radius="max"/>
                                        </cl-image>

                                    </div>

                                    <div class="col-xs-12 no-padding pmo-stat proposalProName">
                                        <h2 class="yakaEllipsis">
                                            {{vm.project.user.firstName}}
                                            {{vm.project.user.lastName}}
                                        </h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pm-body clearfix">

                        <ul class="tab-nav tab-nav-proposal tn-justified">
                            <li heading="Home"
                                data-ng-class="{'active': !vm.showChat}">
                                <a href="" ng-click="vm.showChat = false" class="ng-binding">Détails</a>
                            </li>

                            <li heading="Profile"
                                data-ng-class="{'active': vm.showChat}">
                                <a href="" ng-click="vm.showChat = true; vm.scrollBottom = 1"
                                   class="ng-binding">Messages</a>
                            </li>
                        </ul>

                        <yaka-chat class="scrollViewChatProposal" data-ng-show="vm.showChat"
                                   scroll-bottom="{{vm.scrollBottom}}"
                                   chat-id="{{vm.proposal.chat.id}}"
                                   proposal-status="{{vm.proposal.status}}"
                                   user-me="app.getUser()"
                                   user-other="vm.proposal.project.user"></yaka-chat>

                        <div data-ng-show="!vm.showChat">

                            <div class="pm-overview visible-xs">
                                <div class="mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside"
                                     tabindex="0">
                                    <div
                                        style="position: relative; top: 0px; left: 0px; width: 100%;" dir="ltr">
                                        <div class="pmo-pic">
                                            <div class="p-relative">
                                                <img class="img-responsive proAvatarProposalImage"
                                                     data-ng-if="vm.project.user.avatar.cloudinaryPublicId"
                                                     data-ng-src="{{vm.project.user.avatar.cloudinaryPublicId | yakaCloudinaryUrl:true:259}}"
                                                     alt=""/>

                                                <div class="yakaAvatarInitialsProposal"
                                                     data-ng-if="!vm.project.user.avatar.cloudinaryPublicId">
                                                    {{vm.project.user.firstName[0] | uppercase}}.
                                                    {{vm.project.user.lastName[0]| uppercase}}.
                                                </div>

                                            </div>

                                            <div class="col-xs-12 no-padding pmo-stat proposalProName">
                                                <h2 class="yakaEllipsis">
                                                    {{vm.project.user.firstName}}
                                                    {{vm.project.user.lastName}}
                                                </h2>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="pmb-block">
                                <div class="pmbb-header">
                                    <h2><i class="zmdi zmdi-assignment-o zmdi-hc-fw"></i> Mon devis</h2>
                                </div>
                                <div class="pmbb-body p-l-30">
                                    <div class="pmbb-view">
                                        <dl class="dl-horizontal">
                                            <dt>Mon prix</dt>
                                            <dd class="l-h-18">
                                                {{vm.proposalTmp.price}} € <i
                                                class="zmdi zmdi-edit c-lightblue pointer f-s-20 v-align-bottom m-l-10"
                                                data-ng-click="vm.editPrice()"></i>
                                            </dd>
                                        </dl>
                                        <dl class="dl-horizontal">
                                            <dt>Ma date d'intervention</dt>
                                            <dd class="l-h-18">
                                                {{vm.getStartDate()}} <i
                                                class="zmdi zmdi-edit c-lightblue pointer f-s-20 v-align-botttom m-l-10"
                                                data-ng-click="vm.editDate()"></i>
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>

                            <div class="pmb-block">
                                <div class="pmbb-header">
                                    <h2><i class="zmdi zmdi-assignment zmdi-hc-fw"></i> Informations</h2>
                                </div>
                                <div class="pmbb-body p-l-30">
                                    <div class="pmbb-view">
                                        <dl class="dl-horizontal">
                                            <dt>Lieu du chantier</dt>
                                            <dd>
                                                XXXXXXXXXXX<br/>
                                                XXXXXXXXX<br/>
                                                XXXXX XXXXXXX
                                            </dd>
                                        </dl>
                                        <dl class="dl-horizontal">
                                            <dt>Début des travaux souhaité</dt>
                                            <dd>
                                                XXXXXXXXX
                                            </dd>
                                        </dl>
                                        <dl class="dl-horizontal"
                                            data-ng-if="vm.proposal.professional.qualities && vm.proposal.professional.qualities.length > 0">
                                            <dt>Mots clés</dt>
                                            <dd>
                                                <ul class="yaka-chips">
                                                    <li data-ng-repeat="quality in vm.proposal.professional.qualities">
                                                        {{'CRITERION_' + quality.name | translate}}
                                                    </li>
                                                </ul>
                                            </dd>
                                        </dl>
                                        <dl class="dl-horizontal">
                                            <dt>Description</dt>
                                            <dd>
                                                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque
                                                fermentum eleifend nunc eget cursus. Nullam vitae iaculis ligula. Nam
                                                sed cursus lorem. Sed lorem lectus, lobortis at nisi nec, posuere
                                                consequat sapien. Donec semper blandit orci, aliquam efficitur dolor.
                                                Suspendisse potenti.
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>

                            <div class="pmb-block"
                                 ng-if="vm.projectTmp.images && vm.projectTmp.images.length > 0">
                                <div class="pmbb-header">
                                    <h2><i class="zmdi zmdi-collection-image zmdi-hc-fw"></i> Photos</h2>
                                </div>
                                <div class="pmbb-body p-l-30">
                                    <div class="pmbb-view">
                                        <div class="lightbox photos clearfix">
                                            <div
                                                data-src="{{image.cloudinaryPublicId | yakaCloudinaryUrl}}"
                                                class="lightboxItemAngular col-md-2 col-sm-3 col-xs-4"
                                                ng-repeat="image in vm.projectTmp.images">
                                                <div class="lightbox-item p-item">
                                                    <img
                                                        ng-src="{{image.cloudinaryPublicId | yakaCloudinaryUrl:true}}"
                                                        alt=""/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="container m-t-30">
            <div class="card">

                <ul class="tab-nav tn-justified">
                    <li heading="Home"
                        data-ng-class="{'active': !vm.showChat}">
                        <a href="" ng-click="vm.showChat = false" class="ng-binding">Détails</a>
                    </li>

                    <li heading="Profile"
                        data-ng-class="{'active': vm.showChat}">
                        <a href="" ng-click="vm.showChat = true; vm.scrollBottom = 1" class="ng-binding">Messages</a>
                    </li>
                </ul>

                <yaka-chat data-ng-show="vm.showChat"
                           scroll-bottom="{{vm.scrollBottom}}"
                           chat-id="{{vm.proposal.chat.id}}"
                           proposal-status="{{vm.proposal.status}}"
                           user-me="app.getUser()"
                           user-other="vm.proposal.project.user"></yaka-chat>

                <div data-ng-show="!vm.showChat">
                    <div class="row no-margin">
                        <div class="col-xs-12">
                            <div class="description-action-btn" ng-click="vm.edit()"
                                 ng-show="!vm.editFlag && (vm.proposal.status == 'START' || vm.proposal.status == 'SELECTED')">
                                MODIFIER
                            </div>
                            <div class="description-action-btn"
                                 ng-show="!vm.editFlag && (vm.proposal.status == 'START' || vm.proposal.status == 'SELECTED')"
                                 ng-click="vm.cancelProposalModal()">
                                ANNULER MA PROPOSITION
                            </div>
                            <div class="description-action-btn color-red" ng-show="vm.editFlag" ng-click="vm.save()">
                                ENVOYER
                            </div>
                            <div class="description-action-btn" ng-show="vm.editFlag" ng-click="vm.cancel()">
                                ANNULER
                            </div>
                            <div class="description-date" am-time-ago="vm.proposal.updated">
                                Ma proposition
                            </div>
                        </div>
                    </div>
                    <div class="row no-margin">
                        <div class="col-xs-12">
                            <p class="pro-title-post">
                                Mis à jour le <span am-time-ago="vm.project.updated"></span>
                            </p>
                            <cl-image public-id="{{vm.proposal.professional.user.avatar.cloudinaryPublicId}}"
                                      class="img-circle pro-icon-medium mt-20 fl-l ml-15" format="png"
                                      ng-if="vm.proposal.professional.user.avatar.cloudinaryPublicId">
                                <cl-transformation height="70" width="70" crop="fill"/>
                            </cl-image>
                            <div class="img-default-medium mt-20 fl-l ml-15"
                                 ng-if="!vm.proposal.professional.user.avatar.cloudinaryPublicId">
                                {{vm.proposal.professional.user.firstName[0] | uppercase}}
                                {{vm.proposal.professional.user.lastName[0] | uppercase}}
                            </div>
                            <div class="pro-proposal-title">
                                <p ng-class="{'red': vm.project.type == 'EMERGENCY'}">
                                    {{vm.project.title | yakaTranslateTitle}}
                                </p>

                                <p>
                                    {{vm.project.user.firstName}} {{vm.project.user.lastName}}
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="row no-margin">
                        <div class="col-xs-12 ">
                            <div id="map_canvas">
                                <ui-gmap-google-map center="map.center" zoom="map.zoom" options="mapOptions"
                                                    dragging="false">
                                    <ui-gmap-circle
                                        ng-if="vm.proposalTmp.status != 'SELECTED' && vm.proposalTmp.status != 'RATE_PRO' && vm.proposalTmp.status != 'COMPLETED'"
                                        center="vm.circle.center" stroke="vm.circle.stroke"
                                        fill="vm.circle.fill" radius="vm.circle.radius"
                                        bounds="vm.circle.bounds"
                                        visible="vm.circle.visible" geodesic="true" editable="false"
                                        draggable="false" clickable="true" control="vm.circle.control"
                                        events="vm.circle.events"></ui-gmap-circle>
                                    <ui-gmap-marker
                                        ng-if="vm.proposalTmp.status == 'SELECTED' || vm.proposalTmp.status == 'RATE_PRO' || vm.proposalTmp.status == 'COMPLETED'"
                                        idKey='1' coords='vm.marker.coords'
                                        visible="vm.marker.visible"></ui-gmap-marker>
                                </ui-gmap-google-map>
                            </div>
                        </div>
                    </div>
                    <div class="row no-margin">
                        <div class="col-xs-12 row no-margin" ng-class="{'cursor-pointer': vm.editFlag}"
                             ng-click="vm.editPrice()" role="grid">
                            <div class="col-xs-12 description-sub-title color-blue">
                                Mon prix
                                <span class="icon-pen-blue" ng-show="vm.editFlag"></span>

                                <p class="my-price-proposal">
                                    {{vm.proposalTmp.price}} €
                                </p>
                            </div>
                            <div class="col-xs-12 description-sub-text">
                                C'est un prix {{vm.proposalTmp.priceType | lowercase}}
                            </div>
                        </div>
                    </div>
                    <div class="row no-margin">
                        <div class="col-xs-12 row no-margin" ng-class="{'cursor-pointer': vm.editFlag}"
                             ng-click="vm.editDate()" role="grid">
                            <div class="col-xs-12 description-sub-title color-blue">
                                Ma date d'intervention
                                <span class="icon-pen-blue" ng-show="vm.editFlag" ng-click="vm.editWhen()"></span>

                                <p class="start-date-proposal">
                                    {{vm.getStartDate()}}
                                </p>
                            </div>
                            <div class="col-xs-12 description-sub-text">
                                Quand pourriez-vous commencer ?
                            </div>
                        </div>
                    </div>
                    <div class="row no-margin">
                        <div class="col-xs-12 row no-margin">
                            <div class="col-xs-12 description-sub-title">
                                Où
                            </div>
                            <div class="col-xs-12 description-sub-text">
                                <div ng-switch on="vm.proposal.status">
                                    <div ng-switch-when="SELECTED">
                                        {{vm.projectTmp.address.address}}
                                    </div>
                                    <div ng-switch-when="RATE_PRO">
                                        {{vm.projectTmp.address.address}}
                                    </div>
                                    <div ng-switch-when="COMPLETED">
                                        {{vm.projectTmp.address.address}}
                                    </div>
                                    <div ng-switch-default>
                                        {{vm.projectTmp.address.locality}} {{vm.projectTmp.address.postalCode}}
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="row no-margin">
                        <div class="col-xs-12 row no-margin">
                            <div class="col-xs-12 description-sub-title">
                                Quand
                            </div>
                            <div class="col-xs-12 description-sub-text">
                                Début souhaité {{vm.getWhen()}}
                            </div>
                        </div>
                    </div>
                    <div class="row no-margin">
                        <div class="col-xs-12 row no-margin">
                            <div class="col-xs-12 description-sub-title">
                                Mots clés
                            </div>
                            <div class="col-xs-12 description-sub-text">
                                {{vm.getTags() | yakaTranslateTags}}
                            </div>
                        </div>
                    </div>
                    <div class="row no-margin">
                        <div class="col-xs-12 row no-margin">
                            <div class="col-xs-12 description-sub-title">
                                Description
                            </div>
                            <div class="col-xs-12 description-sub-text">
                            <textarea msd-elastic class="custom-textarea" disabled
                                      ng-model="vm.projectTmp.description"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="row no-margin" ng-if="vm.projectTmp.images && vm.projectTmp.images.lenght != 0">
                        <div class="col-xs-12 row no-margin">
                            <div class="col-xs-12 description-sub-title">
                                Photos
                            </div>
                            <div class="col-xs-12 description-sub-text row m-b-15 m-t-15">
                                <div class="col-xs-3" ng-repeat="media in vm.projectTmp.images"
                                     title="{{media.description}}" ng-click="vm.selectImagePreview(media)">
                                <span class="center-middle img-comment" ng-show="media.description"
                                      ng-click="vm.editImage(media)"></span>
                                    <cl-image public-id="{{media.cloudinaryPublicId}}" secure="true" format="png"
                                              class="center"
                                              ng-click="vm.editImage(media)" ng-class="{'hover-border': vm.editFlag}">
                                        <cl-transformation height="92" width="92" crop="fill"/>
                                    </cl-image>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <div class="yakaPopup" ng-show="vm.myPriceFlag"
         ng-click="vm.myPriceFlag = false" ng-cloak>
        <div class="container">
            <div class="yakaPopupWindow col-xs-12" ng-click="$event.stopPropagation()">
                <img class="popupCloseButton" src="icons/mdpi/ic_popup_close.png"
                     ng-click="vm.myPriceFlag = false" alt=""/>
                <h4>Mon prix</h4>

                <div class="row">
                    <div class="col-xs-6 col-xs-offset-4">
                        <input type="text" class="form-control t-right f-s-18" id="exampleInputEmail2"
                               placeholder="Entrer un prix"
                               ng-model="vm.myPrice"
                               yaka-input-numbers-only>
                    </div>
                    <div class="col-xs-2 sym-euro">
                        €
                    </div>
                </div>
                <p class="error center my-price-error" ng-show="vm.error.price.flag">
                    {{vm.error.price.message}}
                </p>

                <div class="clearfix m-t-10 f-right">
                    <button class="btn bgm-lightblue waves-effect" ng-click="vm.selectPrice(); vm.save()">
                        Enregistrer
                    </button>
                </div>

            </div>
        </div>
    </div>


    <div class="yakaPopup" ng-show="vm.myDateFlag"
         ng-click="vm.myDateFlag = false" ng-cloak>
        <div class="container">
            <div class="yakaPopupWindow col-xs-12" ng-click="$event.stopPropagation()">
                <img class="popupCloseButton" src="icons/mdpi/ic_popup_close.png"
                     ng-click="vm.myDateFlag = false" alt=""/>
                <h4>Ma date d'intervention</h4>

                <div style="display:inline-block" class="center custom-picker">
                    <uib-datepicker ng-model="vm.dt" datepicker-options="vm.datepickerOptions"
                                    class="well well-sm custom-date"></uib-datepicker>
                </div>
                <div class="clearfix m-t-10 f-right">
                    <button class="btn bgm-lightblue waves-effect"
                            ng-click="vm.myDateFlag = false; vm.selectDate(); vm.save()">
                        Enregistrer
                    </button>
                </div>
            </div>
        </div>
    </div>

</section>
